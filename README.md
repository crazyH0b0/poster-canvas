## 难点

1、 解决 tailwind 和 mantine 的样式冲突
2、 开始拖拽和结束拖拽 2 个事件分别处于不同组件，如何传递被拖拽组件的信息
3、 如何把组件拖拽到画布，在画布中记录组件被拖放入的位置下标，此时需要注意这里得到的位置下标是相对网页的，但是我们最后需要的是相对画布的位置下标。还需要考虑到元素本身的宽度和高度。假设 item 是正方形，则拖动时鼠标位于 item 的中心则需要减去元素宽/高的一半。也就是说，要将鼠标在元素中的位置设置为元素的中心，需要再减去元素自身宽度和高度的一半。
4、元素的单选和多选
5、编辑区域移动单个或多个组件，多选的时候编辑区域根据组件之间不同的位置，生成一个红框把选中的组件进行框选
6、画布的缩放，一旦画布缩放，组件的大小、拖拽和拖放的距离也需要跟着调整
7、画布缩放的时候使用 transform:scale(zoom / 100)，需要搭配 transformOrigin(50%,0) 使用，不然放大的时候会从中间开始覆盖 header 部分
8、编辑区域拓展为伸缩区域，封装 flex-dots 组件，可以对当前编辑区域的组件的大小进行缩放，伸缩后的组件的宽高不能小于 2px
9、组件伸缩的时候需要考虑,在什么方位的伸缩会改变 top 和 left,计算组件拉伸的位置和宽高的变化,代码中的坐标系规定向上是负方向,需要注意取反
10、双击文本组件触发编辑模式，需要考虑 textarea 的 width 和 height 要与原本的文字 div 保持一致，监听 textarea 的 scrollHeight 改变，也需要修改原本文字 div 的高度。
11、文本组件需要加上 overflow-wrap: break-word，处理文本太长不会断开并且溢出的问题
12、textarea 换行后文本组件的文字不会换行，需要给文本组件添加 CSS 属性 white-space: pre-wrap; 来使 div 元素保留空白字符和换行符
13、为了避免一些组件把其他组件盖住，开发显示附件的组件的功能，需要计算被选中组件与其他组件是否有重叠，显示被重叠的组件
14、显示画布的吸附线，计算选中组件距离画布特定点位(顶部、底部、中心、左边、右边)的距离。距离差值小于 12 显示吸附线，小于 3 自动对齐吸附。因为组件是靠 top 和 left 进行定位的，所以要计算它的 bottom 和 right 给 top 和 left 赋值
15、旋转组件，涉及到了三角函数等知识
16、组合组件。选中多个组件，点击组合按钮，使这些组件被组合在一起，功能和选中多个相同。组合组件需要有父级组件
17、组合组件和其他组件再组合的时候，需要重新组合成一个组件。
18、当子组件变动，父组件随之变动。删除组合组件的时候需要对该组件是否为组合组件进行判断，如果是则需要重新计算编辑区域的 style
19、组合组件的复制、置顶和置底，需要对组合组件进行判断并执行不同的逻辑
20、目前所有组合组件铺平处理。嵌套处理的话，渲染方便。

## 后续优化

1、点击左侧物料添加到画布的时候，避免物料的重新渲染：把 addComponent 放到外部, 不要过度使用 zustand 自定义 hooks

```// 避免物料选项栏重新渲染
export const addComponent = (component: IComponent) => {
  useEditStore.setState((state) => {
    state.canvas.components.push({ ...component, key: crypto.randomUUID() })
  })
}
``

```
